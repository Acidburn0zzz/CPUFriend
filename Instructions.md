CPUFriend Installation & Usage
===================================

## WARNING
Do NOT use CPUFriend until one knows clearly what *power management data* really is! [FrequencyVectors.bt](https://github.com/acidanthera/CPUFriend/blob/master/Tools/FrequencyVectors.bt) can be a good start. *One thing worth mentioning is that CPUFriend should NOT be used only for patching LFM. (Low Frequency Mode)*

#### Installation
It's highly recommended to load CPUFriend via kext injection powered by bootloader, otherwise [LiluFriend](https://github.com/PMheart/LiluFriend) may be needed to ensure full functionality. Theoretically both `ACPI_SMC_PlatformPlugin.kext` and `X86PlatformPlugin.kext` should remain untouched. If the very only direct modification is applied to personalities (i.e plists from `Resources`), then safely wait for the next system upgrade. (Patched kexts will be restored by then)

#### Technical background
Function `configResourceCallback(unsigned int, int, void const*, unsigned int, void*)` from `ACPI_SMC_PlatformPlugin` or `X86PlatformPlugin`, is hooked by CPUFriend to handle customized power management data.

#### Available kernel flags
Add `-cpufdbg` to enable debug logging (ONLY available in DEBUG binaries).

Add `-cpufoff` to disable CPUFriend entirely.

Add `-cpufbeta` to enable CPUFriend on unsupported OS versions.

#### Configuration
Use `CPUFriend/ResourceConverter.sh` to generate a working copy of either `CPUFriendDataProvider.kext`(Easiness preferred) or `ssdt_data.dsl`(Speed preferred).
If you also have a SSDT generated by [ssdtPRGen.sh](https://github.com/Piker-Alpha/ssdtPRGen.sh), then you have to merge them. See [Combining Data](https://github.com/PMheart/CPUFriend/blob/master/Instructions.md#combining-data) for more details.

#### Usage of ResourceConverter.sh
`--kext /path/to/file`
	Create `CPUFriendDataProvider.kext` with information provided by `file`.
	
`--acpi /path/to/file`
	Create `ssdt_data.dsl` with information provided by `file`.

NOTE:
- The created kext/ssdt is located in the current working directory.
-  `file` should be a ***complete plist*** from `/System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/ACPI_SMC_PlatformPlugin.kext/Contents/Resources` or `/System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/X86PlatformPlugin.kext/Contents/Resources` ***with certain modifications*** (Otherwise why do you even need CPUFriend?) instead of something like a raw `FrequencyVectors` entry.

#### Combining Data
1. Generate a correct copy of `ssdt_data.dsl` with `./ResourceConverter.sh --acpi /path/to/file`.
2. Open your SSDT generated by [ssdtPRGen.sh](https://github.com/Piker-Alpha/ssdtPRGen.sh), and search for `Method (_DSM, 4, NotSerialized)` in your editor.
3. Paste `"cf-frequency-data"` entry from `ssdt_data.dsl` to the SSDT generated by [ssdtPRGen.sh](https://github.com/Piker-Alpha/ssdtPRGen.sh). It will look like this if everything is done.
```
        //
        // Context of the SSDT generated by ssdtPRGen.sh
        //
        Method (_DSM, 4, NotSerialized)
        {
            If (LEqual (Arg2, Zero))
            {
                Return (Buffer (One)
                {
                     0x03
                })
            }

            Return (Package () // size removed, just let the compiler fill it up
            {
                "plugin-type", 
                One,
		
                //
                // Paste it from ssdt_data.dsl
                //
                "cf-frequency-data",
                Buffer () // size removed, just let the compiler fill it up
                {
                    // Data from ssdt_data.dsl
                }
            })
        }
	//
	// Context of the SSDT generated by ssdtPRGen.sh
	//
```
4. Save changes and enjoy the new SSDT.
